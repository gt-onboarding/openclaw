---
title: コンパクション
summary: "コンテキストウィンドウとコンパクション: OpenClaw がセッションをモデルの制限内に保つ仕組み"
read_when:
  - 自動コンパクションと /compact を理解したいとき
  - コンテキスト制限に達する長いセッションをデバッグしているとき
---

<div id="context-window-compaction">
  # コンテキストウィンドウと圧縮
</div>

すべてのモデルには **コンテキストウィンドウ**（参照可能なトークンの最大数）があります。長時間続くチャットではメッセージやツールの結果が蓄積されていきますが、ウィンドウに余裕がなくなってくると、OpenClaw は上限内に収まるよう古い履歴を**圧縮**します。

<div id="what-compaction-is">
  ## コンパクションとは何か
</div>

コンパクションは、**古い会話を要約して**コンパクトな要約エントリにまとめ、最近のメッセージはそのまま保持します。要約はセッション履歴に保存されるため、以降のリクエストでは次のものが使われます。

* コンパクションサマリー
* コンパクション実行時点以降の最近のメッセージ

コンパクションの結果はセッションの JSONL 履歴に**永続的に保存されます**。

<div id="configuration">
  ## 設定
</div>

`agents.defaults.compaction` の設定については、[コンパクションの設定とモード](/ja/concepts/compaction) を参照してください。

<div id="auto-compaction-default-on">
  ## 自動コンパクション（デフォルトで有効）
</div>

セッションがモデルのコンテキストウィンドウの上限に近づく、または超過した場合、OpenClaw は自動コンパクションを実行し、コンパクト化したコンテキストを使って元のリクエストを再試行することがあります。

次のように表示されます:

* 詳細モードでは `🧹 Auto-compaction complete`
* `/status` に `🧹 Compactions: <count>` が表示される

コンパクションの前に、OpenClaw は永続的なノートをディスクに保存するために、**サイレントメモリフラッシュ** のターンを実行できます。詳細および設定については [Memory](/ja/concepts/memory) を参照してください。

<div id="manual-compaction">
  ## 手動コンパクション
</div>

`/compact`（必要に応じて追加の指示を付けて）を使用して、コンパクション処理を強制的に実行します。

```
/compact Focus on decisions and open questions
```

<div id="context-window-source">
  ## コンテキストウィンドウの決定元
</div>

コンテキストウィンドウはモデルごとに異なります。OpenClaw は、設定済みのプロバイダーカタログ内のモデル定義から、この制限値を決定します。

<div id="compaction-vs-pruning">
  ## コンパクションとプルーニング
</div>

* **コンパクション (compaction)**: 要約した内容を JSONL に**永続化**します。
* **セッション・プルーニング**: 古い**ツール結果**のみを、リクエストごとに**メモリ上で**削除します。

プルーニングの詳細については、[/concepts/session-pruning](/ja/concepts/session-pruning) を参照してください。

<div id="tips">
  ## ヒント
</div>

* セッションが古くなったりコンテキストが肥大化していると感じたら、`/compact` を使用してください。
* 大きなツール出力はすでに省略されていますが、さらに間引くことでツール結果の蓄積をより抑えられます。
* まっさらな状態が必要な場合は、`/new` または `/reset` で新しいセッション ID のセッションを開始できます。