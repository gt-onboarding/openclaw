---
title: アイコン
summary: "macOS 上の OpenClaw のメニューバーアイコンの状態とアニメーション"
read_when:
  - メニューバーアイコンの挙動を変更するとき
---

<div id="menu-bar-icon-states">
  # メニューバーアイコンの状態
</div>

Author: steipete · 更新日: 2025-12-06 · スコープ: macOS アプリ (`apps/macos`)

- **アイドル:** 通常のアイコンアニメーション（まばたき、たまに小さく揺れる）。
- **一時停止:** ステータスアイテムで `appearsDisabled` を使用し、モーションなし。
- **音声トリガー（ビッグイヤー）:** 音声ウェイク検出器がウェイクワードを検知すると `AppState.triggerVoiceEars(ttl: nil)` を呼び出し、発話を取り込んでいる間は `earBoostActive=true` を維持する。耳はスケールアップ（1.9 倍）し、視認性向上のため円形の耳穴が付く。その後、1 秒間の無音で `stopVoiceEars()` により解除される。アプリ内の音声パイプラインからのみトリガーされる。
- **作業中（エージェント実行中）:** `AppState.isWorking=true` により「しっぽ／脚がちょこちょこ動く」マイクロモーションが駆動される。脚の揺れが速くなり、作業中は位置がわずかにオフセットされる。現在は WebChat エージェントの実行時にトグルしている。他の長時間タスクを配線する際も同様のトグルを追加すること。

配線ポイント

- 音声ウェイク: ランタイム／テスターはトリガー時に `AppState.triggerVoiceEars(ttl: nil)` を呼び、無音が 1 秒続いたら `stopVoiceEars()` を呼んでキャプチャウィンドウと合わせる。
- エージェントのアクティビティ: 作業区間を囲む形で `AppStateStore.shared.setWorking(true/false)` を設定する（WebChat エージェント呼び出しではすでに実装済み）。アニメーションが固まらないよう、区間を短く保ち、`defer` ブロック内で必ずリセットすること。

形状とサイズ

- ベースアイコンは `CritterIconRenderer.makeIcon(blink:legWiggle:earWiggle:earScale:earHoles:)` で描画される。
- 耳のスケールのデフォルトは `1.0`。音声ブーストでは `earScale=1.9` に設定し、全体のフレームを変更せずに（18×18 pt のテンプレート画像が 36×36 px の Retina バッキングストアにレンダリングされる）、`earHoles=true` をトグルする。
- 「scurry」は脚の揺れを最大 ~1.0 まで使い、小さな水平方向の揺れを加える。既存のアイドル時の揺れに対して加算的に作用する。

動作上の注意

- 耳／作業中状態に対する外部の CLI／ブローカー用トグルは設けない。誤ったフラッピングを避けるため、アプリ自身のシグナルに限定すること。
- ジョブがハングした場合でもアイコンがすぐベースラインに戻るように、TTL は短く（&lt;10 秒）保つこと。